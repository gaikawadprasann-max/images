<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚ú¶ Prasann's Space</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400;1,500&family=Space+Grotesk:wght@300;400;500;600&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="bg-base"></div>
<div id="bg-img"></div>
<div id="bg-grain"></div>
<div id="aurora">
  <div class="aurora-blob" style="width:500px;height:500px;top:-100px;left:-100px;background:radial-gradient(circle,#f0a8c0,transparent 70%);animation-duration:22s;"></div>
  <div class="aurora-blob" style="width:400px;height:400px;bottom:-80px;right:-80px;background:radial-gradient(circle,#88d4f5,transparent 70%);animation-duration:18s;animation-delay:-7s;"></div>
  <div class="aurora-blob" style="width:350px;height:350px;top:40%;left:40%;background:radial-gradient(circle,#a8e6c8,transparent 70%);animation-duration:25s;animation-delay:-12s;opacity:0.08;"></div>
</div>
<div id="vignette"></div>
<div id="particles"></div>

<!-- FOCUS MODE -->
<div id="focusMode">
  <div class="focus-clock" id="focusClock">00:00</div>
  <div class="focus-date" id="focusDate"></div>
  <div class="focus-quote" id="focusQuote"></div>
  <button class="btn pink focus-exit" onclick="toggleFocus()">‚úï Exit Focus</button>
</div>

<div class="page">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="greeting-wrap">
      <div class="greeting" id="greeting"></div>
      <div class="date-line" id="dateText"></div>
      <div class="quote-bar" id="quoteStrip"></div>
    </div>
    <div class="topbar-right">
      <div class="glass stat-bar">
        <div class="stat-item"><div class="stat-dot" style="background:var(--accent3)"></div><span id="habitStat">0/0 habits</span></div>
        <div class="stat-item"><div class="stat-dot" style="background:var(--accent)"></div><span id="pomoStat">0 sessions</span></div>
      </div>
      <button class="btn purple" onclick="toggleFocus()">‚óâ Focus</button>
      <button class="btn blue" onclick="openModal('link')">Ôºã Link</button>
      <button class="btn green" onclick="openModal('habit')">Ôºã Habit</button>
      <button class="btn pink" onclick="openSettings()">‚öô Settings</button>
    </div>
  </div>

  <!-- MIDDLE -->
  <div class="middle">
    <!-- LEFT -->
    <div class="left-panel">
      <div class="bookmark-row" id="bookmarks"></div>
      <div class="glass top-sites-card">
        <div class="card-hdr">
          <span class="card-lbl">‚ö° Pinned Sites</span>
          <button class="btn" style="padding:3px 9px;font-size:0.58rem;" onclick="openModal('site')">Ôºã</button>
        </div>
        <div class="ts-grid" id="topSites"></div>
      </div>
      <div class="glass habit-card">
        <div class="card-hdr" style="flex-shrink:0;">
          <span class="card-lbl">‚úì Daily Habits</span>
          <span style="font-size:0.58rem;" id="habitDate"></span>
        </div>
        <div class="habit-list" id="habitList"></div>
        <div class="add-habit-row">
          <input class="add-habit-input" type="text" id="habitInput" placeholder="New habit‚Ä¶">
          <button class="btn green" style="padding:5px 9px;font-size:0.64rem;flex-shrink:0;" onclick="addHabit()">Add</button>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="right-panel">
      <div class="glass clock-card">
        <div class="clock-orb"></div>
        <div class="clock-time" id="clock">00:00<span class="clock-ampm" id="clockAmpm">AM</span></div>
        <span class="clock-sec" id="clockSec">00s</span>
        <div class="clock-sub" id="clockSub"></div>
      </div>
      <div class="right-panel-scroll">
        <div class="glass wx-card" id="wxCard" onclick="openSettings()">
          <div class="wx-icon" id="wxIcon">‚õÖ</div>
          <div class="wx-detail">
            <div class="wx-temp" id="wxTemp">‚Äî¬∞</div>
            <div class="wx-city" id="wxCity">Set city in Settings</div>
            <div class="wx-desc" id="wxDesc"></div>
            <div class="wx-feels" id="wxFeels"></div>
          </div>
        </div>
        <div class="glass cdown-card" id="cdownCard" onclick="openModal('countdown')">
          <div class="card-hdr" style="margin-bottom:6px;">
            <span class="card-lbl">‚è≥ Countdown</span>
            <button class="btn" style="padding:2px 8px;font-size:0.56rem;" onclick="event.stopPropagation();openModal('countdown')">Set</button>
          </div>
          <div class="cdown-inner">
            <div class="cdown-unit"><div class="cdown-num" id="cdownD">--</div><div class="cdown-lbl">days</div></div>
            <div class="cdown-unit"><div class="cdown-num" id="cdownH">--</div><div class="cdown-lbl">hrs</div></div>
            <div class="cdown-unit"><div class="cdown-num" id="cdownM">--</div><div class="cdown-lbl">min</div></div>
            <div class="cdown-unit"><div class="cdown-num" id="cdownS">--</div><div class="cdown-lbl">sec</div></div>
          </div>
          <div class="cdown-event" id="cdownLabel">Set a countdown event</div>
        </div>
        <div class="glass pomo-card">
          <div class="pomo-header">
            <span class="card-lbl">üçÖ Focus Timer</span>
            <span id="pomoStatus">Paused</span>
          </div>
          <div class="pomo-tabs">
            <div class="pomo-tab active" id="pomoTabFocus" onclick="setPomoMode('focus')">Focus</div>
            <div class="pomo-tab" id="pomoTabShort" onclick="setPomoMode('short')">Short</div>
            <div class="pomo-tab" id="pomoTabLong" onclick="setPomoMode('long')">Long</div>
          </div>
          <div class="pomo-ring-wrap">
            <svg class="pomo-ring" viewBox="0 0 76 76">
              <circle cx="38" cy="38" r="32" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="4"/>
              <circle id="pomoArc" cx="38" cy="38" r="32" fill="none" stroke="var(--accent)" stroke-width="4"
                stroke-linecap="round" stroke-dasharray="201" stroke-dashoffset="0"
                transform="rotate(-90 38 38)" style="transition:stroke-dashoffset 0.5s linear,stroke 0.5s;"/>
            </svg>
            <div class="pomo-ring-time" id="pomoTime">25:00</div>
          </div>
          <div class="pomo-controls">
            <button class="pomo-btn" onclick="resetPomo()">‚Ü∫</button>
            <button class="pomo-btn primary" id="pomoStartBtn" onclick="togglePomo()">‚ñ∂ Start</button>
            <button class="pomo-btn" onclick="skipPomo()">‚è≠</button>
          </div>
          <div class="pomo-sessions" id="pomoSessions">Sessions: 0</div>
        </div>
        <div class="glass notes-card">
          <div class="card-hdr" style="margin-bottom:4px;flex-shrink:0;">
            <span class="card-lbl">‚ú¶ Notes</span>
          </div>
          <div class="notes-tabs" id="notesTabs"></div>
          <textarea class="notes-area" id="notes" placeholder="Drop a thought‚Ä¶" rows="5"></textarea>
          <div class="notes-footer">
            <span class="notes-count" id="notesCount">0 chars</span>
            <span class="notes-save" id="notesSave">auto-saved</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BOTTOM -->
  <div class="bottom-section">
    <div>
      <div class="ql-header">
        <span class="ql-lbl">‚ö° Quick Access</span>
        <button class="btn" style="padding:3px 10px;font-size:0.58rem;" onclick="openModal('link')">Ôºã Add</button>
      </div>
      <div class="quick-links" id="quickLinks"></div>
    </div>
    <div class="search-row">
      <form class="glass search-bar" onsubmit="doSearch(event)">
        <span class="s-icon">‚åï</span>
        <input type="text" id="searchInput" placeholder="Search or type a URL‚Ä¶ (Ctrl+K)" autocomplete="off"/>
        <select class="engine-sel" id="engineSelect">
          <option value="https://www.google.com/search?q=">Google</option>
          <option value="https://duckduckgo.com/?q=">DuckDuckGo</option>
          <option value="https://www.bing.com/search?q=">Bing</option>
          <option value="https://search.brave.com/search?q=">Brave</option>
          <option value="https://www.perplexity.ai/search?q=">Perplexity</option>
          <option value="https://www.youtube.com/results?search_query=">YouTube</option>
        </select>
      </form>
      <a class="ai-pill pink" href="https://claude.ai" target="_blank">ü§ñ Claude</a>
      <a class="ai-pill blue" href="https://chat.openai.com" target="_blank">‚ú¶ ChatGPT</a>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- SETTINGS PANEL -->
<div id="sOverlay" onclick="closeSettings()"></div>
<div id="sPanel">
  <div class="s-title">‚ú¶ Customize</div>

  <div class="s-section">
    <span class="s-lbl">üåì Theme</span>
    <div class="theme-row">
      <div class="theme-btn active" id="themeDark" onclick="setTheme('dark')">üåô Dark</div>
      <div class="theme-btn" id="themeLight" onclick="setTheme('light')">‚òÄÔ∏è Light</div>
    </div>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">‚ú® Text Animation</span>
    <div class="ta-grid" id="taGrid">
      <div class="ta-btn active" data-ta="shimmer" onclick="setTextAnim(this,'shimmer')">Shimmer</div>
      <div class="ta-btn" data-ta="glow" onclick="setTextAnim(this,'glow')">Glow Pulse</div>
      <div class="ta-btn" data-ta="float" onclick="setTextAnim(this,'float')">Float</div>
      <div class="ta-btn" data-ta="wave" onclick="setTextAnim(this,'wave')">Wave</div>
      <div class="ta-btn" data-ta="neon" onclick="setTextAnim(this,'neon')">Neon</div>
      <div class="ta-btn" data-ta="rainbow" onclick="setTextAnim(this,'rainbow')">Rainbow</div>
      <div class="ta-btn" data-ta="breathe" onclick="setTextAnim(this,'breathe')">Breathe</div>
      <div class="ta-btn" data-ta="none" onclick="setTextAnim(this,'none')">None</div>
    </div>
    <label style="font-size:0.62rem;color:rgba(255,255,255,0.65);display:block;margin-bottom:3px;">Animation Speed</label>
    <input type="range" class="s-slider" id="taSpeedSlider" min="1" max="10" value="4" oninput="onTaSpeed(this)">
    <span class="s-val" id="taSpeedVal">0.4s</span>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">üñº Background Image</span>
    <label class="s-file-lbl" for="bgFile" id="bgFileLbl">Click to upload (max 5MB)</label>
    <input type="file" id="bgFile" accept="image/*" style="display:none" onchange="handleBgUpload(this)">
    <input class="s-input" type="text" id="bgUrl" placeholder="‚Ä¶or paste image URL">
    <button class="btn pink wide" onclick="applyBg()">Apply Background</button>
    <button class="btn wide" style="opacity:0.45;" onclick="clearBg()">‚úï Remove</button>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">Background Opacity</span>
    <input type="range" class="s-slider" id="bgOpSlider" min="0" max="100" value="100" oninput="onBgOp(this)">
    <span class="s-val" id="bgOpVal">100%</span>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">Element Transparency</span>
    <input type="range" class="s-slider" id="elAlphaSlider" min="3" max="40" value="13" oninput="onElAlpha(this)">
    <span class="s-val" id="elAlphaVal">13%</span>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">Glass Blur</span>
    <div class="s-toggle" id="blurToggle" onclick="toggleBlur()">
      <div class="t-dot"></div><span>Enable glass blur</span>
    </div>
    <div id="blurWrap" style="display:none">
      <input type="range" class="s-slider" id="blurSlider" min="0" max="40" value="18" oninput="onBlur(this)">
      <span class="s-val" id="blurVal">18px</span>
    </div>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">Aurora Intensity</span>
    <input type="range" class="s-slider" id="auroraSlider" min="0" max="30" value="12" oninput="onAurora(this)">
    <span class="s-val" id="auroraVal">12%</span>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">‚Ä¢ Particles</span>
    <input type="range" class="s-slider" id="ptSlider" min="0" max="80" value="20" oninput="onParticles(this)">
    <span class="s-val" id="ptVal">20</span>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">‚õÖ Weather City</span>
    <input class="s-input" type="text" id="wxCityInput" placeholder="e.g. Bengaluru">
    <button class="btn blue wide" onclick="fetchWeather()">Fetch Weather</button>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">Accent Color</span>
    <div class="swatch-row" id="swatchRow">
      <div class="swatch active" data-c="#f0a8c0" style="background:#f0a8c0" onclick="setAccent(this)"></div>
      <div class="swatch" data-c="#88d4f5" style="background:#88d4f5" onclick="setAccent(this)"></div>
      <div class="swatch" data-c="#a8e6c8" style="background:#a8e6c8" onclick="setAccent(this)"></div>
      <div class="swatch" data-c="#d4a8f0" style="background:#d4a8f0" onclick="setAccent(this)"></div>
      <div class="swatch" data-c="#f5d488" style="background:#f5d488" onclick="setAccent(this)"></div>
      <div class="swatch" data-c="#f0a888" style="background:#f0a888" onclick="setAccent(this)"></div>
      <input type="color" id="accentPicker" style="width:26px;height:26px;border-radius:50%;border:2px solid rgba(255,255,255,0.2);cursor:pointer;padding:0;" onchange="setAccentCustom(this)">
    </div>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">üçÖ Pomodoro (minutes)</span>
    <label style="font-size:0.62rem;color:rgba(255,255,255,0.65);display:block;margin-bottom:3px;">Focus</label>
    <input type="range" class="s-slider" id="pomoFSlider" min="5" max="60" value="25" oninput="onPomoF(this)">
    <span class="s-val" id="pomoFVal">25m</span>
    <label style="font-size:0.62rem;color:rgba(255,255,255,0.65);display:block;margin-bottom:3px;">Short Break</label>
    <input type="range" class="s-slider" id="pomoSSlider" min="1" max="15" value="5" oninput="onPomoS(this)">
    <span class="s-val" id="pomoSVal">5m</span>
    <label style="font-size:0.62rem;color:rgba(255,255,255,0.65);display:block;margin-bottom:3px;">Long Break</label>
    <input type="range" class="s-slider" id="pomoLSlider" min="5" max="30" value="15" oninput="onPomoL(this)">
    <span class="s-val" id="pomoLVal">15m</span>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">Quote Speed (seconds)</span>
    <input type="range" class="s-slider" id="qIntSlider" min="5" max="60" value="15" oninput="onQInt(this)">
    <span class="s-val" id="qIntVal">15s</span>
  </div>
  <hr class="s-divider">

  <div class="s-section">
    <span class="s-lbl">Name in Greeting</span>
    <input class="s-input" type="text" id="greetName" placeholder="Prasann">
    <button class="btn blue wide" onclick="saveGreetName()">Save</button>
  </div>
  <hr class="s-divider">

  <button class="btn wide" style="opacity:0.4;" onclick="resetAll()">‚Ü∫ Reset Everything</button>
</div>

<!-- MODALS -->
<div class="modal-overlay" id="linkModal">
  <div class="modal">
    <h2>‚ú¶ Add Quick Link</h2>
    <label>Name</label><input type="text" id="newName" placeholder="YouTube">
    <label>URL</label><input type="text" id="newUrl" placeholder="https://youtube.com">
    <label>Emoji</label><input type="text" id="newIcon" placeholder="‚ñ∂">
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('link')">Cancel</button>
      <button class="btn pink" onclick="addLink()">Add ‚ú¶</button>
    </div>
  </div>
</div>
<div class="modal-overlay" id="habitModal">
  <div class="modal">
    <h2>‚ú¶ Add Daily Habit</h2>
    <label>Habit Name</label><input type="text" id="habitModalName" placeholder="Morning workout">
    <label>Emoji</label><input type="text" id="habitModalIcon" placeholder="üí™">
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('habit')">Cancel</button>
      <button class="btn green" onclick="addHabitModal()">Add ‚ú¶</button>
    </div>
  </div>
</div>
<div class="modal-overlay" id="siteModal">
  <div class="modal">
    <h2>‚ú¶ Add Pinned Site</h2>
    <label>Name</label><input type="text" id="siteName" placeholder="GitHub">
    <label>URL</label><input type="text" id="siteUrl" placeholder="https://github.com">
    <label>Emoji</label><input type="text" id="siteIcon" placeholder="üêô">
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('site')">Cancel</button>
      <button class="btn blue" onclick="addSite()">Add ‚ú¶</button>
    </div>
  </div>
</div>
<div class="modal-overlay" id="countdownModal">
  <div class="modal">
    <h2>‚ú¶ Countdown Timer</h2>
    <label>Event Name</label><input type="text" id="cdownName" placeholder="My Birthday">
    <label>Target Date</label><input type="text" id="cdownDate" placeholder="2025-12-31">
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('countdown')">Cancel</button>
      <button class="btn purple" onclick="setCountdown()">Set ‚ú¶</button>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê */
const MOTIVATIONS = [
  "Show up even when it sucks",
  "Nobody is coming to save you",
  "One hour a day changes everything",
  "Pain now or regret forever",
  "You're closer than you think",
  "Skill beats luck every time",
  "Earn the confidence",
  "Silent work, loud results",
  "Do the boring work brilliantly",
  "Become undeniable",
  "Today's effort is tomorrow's advantage",
  "Progress is built quietly",
  "No shortcuts. No excuses. Only growth.",
  "The gap between who you are and who you want to be is what you do daily",
  "Discipline is choosing between what you want now and what you want most"
];

let GREETINGS_POOL = [
  "Hey Prasann, look who finally showed up.",
  "Good morning, trouble. I was wondering when you'd appear.",
  "Hey you. Yeah you. Don't act surprised, I was waiting.",
  "Well well, there you are. My day just upgraded.",
  "Hey Prasann. Come here. I missed you more than I'm admitting.",
  "Look alive. I'm here and I've got my eyes on you.",
  "Hey. Don't scroll past me like that."
];

const DEF_LINKS = [
  {icon:'‚ñ∂',label:'YouTube',url:'https://youtube.com'},
  {icon:'ùïè',label:'Twitter',url:'https://twitter.com'},
  {icon:'üêô',label:'GitHub',url:'https://github.com'},
  {icon:'üìß',label:'Gmail',url:'https://mail.google.com'},
  {icon:'üì∞',label:'Reddit',url:'https://reddit.com'},
  {icon:'ü§ñ',label:'Claude',url:'https://claude.ai'},
  {icon:'üéµ',label:'Spotify',url:'https://spotify.com'},
  {icon:'üí¨',label:'Discord',url:'https://discord.com'},
];

const DEF_SITES = [
  {icon:'üìß',label:'Gmail',url:'https://mail.google.com'},
  {icon:'üì∞',label:'Reddit',url:'https://reddit.com'},
  {icon:'üêô',label:'GitHub',url:'https://github.com'},
  {icon:'üî•',label:'HN',url:'https://news.ycombinator.com'},
  {icon:'‚ñ∂',label:'YouTube',url:'https://youtube.com'},
  {icon:'üí¨',label:'Discord',url:'https://discord.com'},
  {icon:'üéµ',label:'Spotify',url:'https://spotify.com'},
  {icon:'üåê',label:'Wikipedia',url:'https://wikipedia.org'},
];

const DEF_BOOKMARKS = [
  {icon:'üî•',label:'Hacker News',url:'https://news.ycombinator.com'},
  {icon:'üåê',label:'Wikipedia',url:'https://wikipedia.org'},
];

const DEF_HABITS = [
  {id:1,icon:'üíß',name:'Drink water',streak:0},
  {id:2,icon:'üìö',name:'Read 30 min',streak:0},
  {id:3,icon:'üèÉ',name:'Exercise',streak:0},
];

/* ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê */
function todayStr(){return new Date().toISOString().slice(0,10);}

let links     = JSON.parse(ls('hp3_links')  ||'null') || DEF_LINKS;
let topSites  = JSON.parse(ls('hp3_top')    ||'null') || DEF_SITES;
let bookmarks = JSON.parse(ls('hp3_bmarks') ||'null') || DEF_BOOKMARKS;
let habits    = JSON.parse(ls('hp3_habits') ||'null') || DEF_HABITS;
let habitDone = JSON.parse(ls('hp3_hdone_'+todayStr())||'{}');
let notePages = JSON.parse(ls('hp3_notes')  ||'null') || ['','',''];
let activeNote = 0;
let bgData = ls('hp3_bg') || '';

let cfg = {
  bgOp:100, elAlpha:13, blurOn:true, blurStr:18,
  particles:20, qInt:15,
  wxCity:'', accent:'#f0a8c0',
  pomoF:25, pomoS:5, pomoL:15,
  aurora:12, greetName:'Prasann',
  countdown:null, theme:'dark',
  textAnim:'shimmer', taSpeed:0.4
};
try{Object.assign(cfg, JSON.parse(ls('hp3_cfg')||'{}'));}catch(e){}

function ls(k){try{return localStorage.getItem(k);}catch(e){return null;}}
function ss(k,v){try{localStorage.setItem(k,v);}catch(e){}};
function saveCfg(){ss('hp3_cfg',JSON.stringify(cfg));}

/* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
let toastT;
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  clearTimeout(toastT);toastT=setTimeout(()=>t.classList.remove('show'),2000);
}

/* ‚ïê‚ïê‚ïê THEME ‚ïê‚ïê‚ïê */
function setTheme(t){
  cfg.theme=t;
  if(t==='light'){document.body.classList.add('light');document.getElementById('themeDark').classList.remove('active');document.getElementById('themeLight').classList.add('active');}
  else{document.body.classList.remove('light');document.getElementById('themeDark').classList.add('active');document.getElementById('themeLight').classList.remove('active');}
  saveCfg();showToast(t==='light'?'Light mode on!':'Dark mode on!');
}

/* ‚ïê‚ïê‚ïê TEXT ANIMATIONS ‚ïê‚ïê‚ïê */
function setTextAnim(el,type){
  cfg.textAnim=type;
  document.querySelectorAll('.ta-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  applyTextAnim();saveCfg();
}

function applyTextAnim(){
  const body=document.body;
  ['shimmer','glow','float','wave','neon','rainbow','breathe','none'].forEach(t=>body.classList.remove('ta-'+t));
  body.classList.add('ta-'+cfg.textAnim);
  const greetEl=document.getElementById('greeting');
  if(cfg.textAnim==='wave'){
    const em=greetEl.querySelector('em');
    if(em){
      const text=em.textContent;
      em.innerHTML=text.split('').map((c,i)=>c===' '?'&nbsp;':`<span class="wave-char" style="animation-delay:${i*0.07}s">${c}</span>`).join('');
    }
  } else {
    const em=greetEl.querySelector('em');
    if(em&&em.querySelector('.wave-char')){let str='';em.querySelectorAll('.wave-char').forEach(s=>str+=s.textContent);em.innerHTML=str;}
    if(em) em.classList.add('animated-text');
  }
  const quote=document.getElementById('quoteStrip');
  quote.classList.remove('animated-text');
  if(cfg.textAnim!=='wave') quote.classList.add('animated-text');
  const fc=document.getElementById('focusClock');
  if(fc) fc.classList.toggle('animated-text',cfg.textAnim!=='wave');
}

function onTaSpeed(el){
  const v=+el.value;const speed=(v/10).toFixed(1);cfg.taSpeed=+speed;
  el.style.setProperty('--pct',(v/10)*100+'%');
  document.getElementById('taSpeedVal').textContent=speed+'s';
  document.documentElement.style.setProperty('--ta-speed',speed+'s');
  updateAnimSpeeds(speed);saveCfg();
}

function updateAnimSpeeds(speed){
  let st=document.getElementById('dynamic-anim-speeds');
  if(!st){st=document.createElement('style');st.id='dynamic-anim-speeds';document.head.appendChild(st);}
  const s=parseFloat(speed);
  st.textContent=`
    .ta-shimmer .animated-text{animation-duration:${s*7.5}s;}
    .ta-glow .animated-text{animation-duration:${s*6.25}s;}
    .ta-float .animated-text{animation-duration:${s*7.5}s;}
    .ta-neon .animated-text{animation-duration:${s*7.5}s;}
    .ta-rainbow .animated-text{animation-duration:${s*10}s;}
    .ta-breathe .animated-text{animation-duration:${s*10}s;}
    .ta-wave .wave-char{animation-duration:${s*3.75}s;}
  `;
}

/* ‚ïê‚ïê‚ïê APPLY CONFIG ‚ïê‚ïê‚ïê */
function applyAll(){
  const r=document.documentElement.style;
  r.setProperty('--bg-opacity',cfg.bgOp/100);
  r.setProperty('--el-alpha',cfg.elAlpha/100);
  r.setProperty('--blur-str',cfg.blurOn?cfg.blurStr+'px':'0px');
  r.setProperty('--accent',cfg.accent);

  setSlider('bgOpSlider','bgOpVal',cfg.bgOp,'%',0,100);
  setSlider('elAlphaSlider','elAlphaVal',cfg.elAlpha,'%',3,40);
  setSlider('blurSlider','blurVal',cfg.blurStr,'px',0,40);
  setSlider('qIntSlider','qIntVal',cfg.qInt,'s',5,60);
  setSlider('ptSlider','ptVal',cfg.particles,'',0,80);
  setSlider('pomoFSlider','pomoFVal',cfg.pomoF,'m',5,60);
  setSlider('pomoSSlider','pomoSVal',cfg.pomoS,'m',1,15);
  setSlider('pomoLSlider','pomoLVal',cfg.pomoL,'m',5,30);
  setSlider('auroraSlider','auroraVal',cfg.aurora,'%',0,30);

  const taSpeed=cfg.taSpeed||0.4;
  const taSlider=document.getElementById('taSpeedSlider');
  if(taSlider){const v=taSpeed*10;taSlider.value=v;taSlider.style.setProperty('--pct',(v/10)*100+'%');document.getElementById('taSpeedVal').textContent=taSpeed+'s';}
  r.setProperty('--ta-speed',taSpeed+'s');
  updateAnimSpeeds(taSpeed);

  const bt=document.getElementById('blurToggle'),bw=document.getElementById('blurWrap');
  cfg.blurOn?bt.classList.add('active'):bt.classList.remove('active');
  bw.style.display=cfg.blurOn?'block':'none';

  initParticles(cfg.particles);
  applyAurora(cfg.aurora);
  applyBackground(bgData);

  const gi=document.getElementById('greetName');
  if(gi) gi.value=cfg.greetName||'Prasann';
  if(cfg.wxCity) document.getElementById('wxCityInput').value=cfg.wxCity;

  document.querySelectorAll('.swatch').forEach(s=>s.classList.toggle('active',s.dataset.c===cfg.accent));
  const ap=document.getElementById('accentPicker');
  if(ap) ap.value=cfg.accent||'#f0a8c0';

  if(cfg.theme) setTheme(cfg.theme);
  if(cfg.textAnim){document.querySelectorAll('.ta-btn').forEach(b=>b.classList.toggle('active',b.dataset.ta===cfg.textAnim));}
  if(cfg.countdown) renderCountdown();
}

function setSlider(id,valId,val,unit,min,max){
  const el=document.getElementById(id),vl=document.getElementById(valId);
  if(!el)return;el.value=val;
  const pct=((val-min)/(max-min))*100;
  el.style.setProperty('--pct',pct+'%');
  if(vl) vl.textContent=val+unit;
}

/* ‚ïê‚ïê‚ïê SLIDER HANDLERS ‚ïê‚ïê‚ïê */
function onBgOp(el){cfg.bgOp=+el.value;el.style.setProperty('--pct',cfg.bgOp+'%');document.getElementById('bgOpVal').textContent=cfg.bgOp+'%';document.documentElement.style.setProperty('--bg-opacity',cfg.bgOp/100);saveCfg();}
function onElAlpha(el){cfg.elAlpha=+el.value;const pct=((cfg.elAlpha-3)/37)*100;el.style.setProperty('--pct',pct+'%');document.getElementById('elAlphaVal').textContent=cfg.elAlpha+'%';document.documentElement.style.setProperty('--el-alpha',cfg.elAlpha/100);saveCfg();}
function toggleBlur(){cfg.blurOn=!cfg.blurOn;applyAll();saveCfg();}
function onBlur(el){cfg.blurStr=+el.value;const pct=(cfg.blurStr/40)*100;el.style.setProperty('--pct',pct+'%');document.getElementById('blurVal').textContent=cfg.blurStr+'px';document.documentElement.style.setProperty('--blur-str',cfg.blurStr+'px');saveCfg();}
function onQInt(el){cfg.qInt=+el.value;const pct=((cfg.qInt-5)/55)*100;el.style.setProperty('--pct',pct+'%');document.getElementById('qIntVal').textContent=cfg.qInt+'s';saveCfg();restartQuotes();}
function onParticles(el){cfg.particles=+el.value;el.style.setProperty('--pct',(cfg.particles/80)*100+'%');document.getElementById('ptVal').textContent=cfg.particles;initParticles(cfg.particles);saveCfg();}
function onAurora(el){cfg.aurora=+el.value;const pct=(cfg.aurora/30)*100;el.style.setProperty('--pct',pct+'%');document.getElementById('auroraVal').textContent=cfg.aurora+'%';applyAurora(cfg.aurora);saveCfg();}
function onPomoF(el){cfg.pomoF=+el.value;const pct=((cfg.pomoF-5)/55)*100;el.style.setProperty('--pct',pct+'%');document.getElementById('pomoFVal').textContent=cfg.pomoF+'m';saveCfg();if(pomoMode==='focus'&&!pomoRunning)resetPomo();}
function onPomoS(el){cfg.pomoS=+el.value;const pct=((cfg.pomoS-1)/14)*100;el.style.setProperty('--pct',pct+'%');document.getElementById('pomoSVal').textContent=cfg.pomoS+'m';saveCfg();if(pomoMode==='short'&&!pomoRunning)resetPomo();}
function onPomoL(el){cfg.pomoL=+el.value;const pct=((cfg.pomoL-5)/25)*100;el.style.setProperty('--pct',pct+'%');document.getElementById('pomoLVal').textContent=cfg.pomoL+'m';saveCfg();if(pomoMode==='long'&&!pomoRunning)resetPomo();}
function resetAll(){if(!confirm('Reset everything?'))return;try{localStorage.clear();}catch(e){}location.reload();}
function saveGreetName(){const v=document.getElementById('greetName').value.trim();if(v){cfg.greetName=v;saveCfg();setGreeting();showToast('Name saved!');}}

function setAccent(el){cfg.accent=el.dataset.c;document.documentElement.style.setProperty('--accent',cfg.accent);document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('active'));el.classList.add('active');saveCfg();}
function setAccentCustom(el){cfg.accent=el.value;document.documentElement.style.setProperty('--accent',cfg.accent);document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('active'));saveCfg();}

/* ‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê */
function openSettings(){document.getElementById('sPanel').classList.add('open');document.getElementById('sOverlay').classList.add('open');}
function closeSettings(){document.getElementById('sPanel').classList.remove('open');document.getElementById('sOverlay').classList.remove('open');}

/* ‚ïê‚ïê‚ïê BACKGROUND ‚ïê‚ïê‚ïê */
function applyBackground(src){const el=document.getElementById('bg-img');if(!el)return;el.style.backgroundImage=src?`url('${src}')`:'none';}
if(bgData) applyBackground(bgData);

function handleBgUpload(input){
  const file=input.files[0];if(!file)return;
  if(file.size>5242880){alert('Max 5MB');input.value='';return;}
  document.getElementById('bgFileLbl').textContent='‚è≥ Loading‚Ä¶';
  const r=new FileReader();
  r.onload=e=>{bgData=e.target.result;document.getElementById('bgFileLbl').textContent='‚úì '+file.name;document.getElementById('bgUrl').value='';};
  r.readAsDataURL(file);
}
function applyBg(){const urlVal=document.getElementById('bgUrl').value.trim();const src=urlVal||bgData;if(!src){alert('Upload or enter URL');return;}try{ss('hp3_bg',src);}catch(e){}applyBackground(src);showToast('Background applied!');}
function clearBg(){bgData='';try{localStorage.removeItem('hp3_bg');}catch(e){}applyBackground('');document.getElementById('bgFileLbl').textContent='Click to upload';document.getElementById('bgUrl').value='';showToast('Background cleared.');}

/* ‚ïê‚ïê‚ïê AURORA ‚ïê‚ïê‚ïê */
function applyAurora(v){document.querySelectorAll('.aurora-blob').forEach(b=>{b.style.opacity=v/100;});}

/* ‚ïê‚ïê‚ïê CLOCK ‚ïê‚ïê‚ïê */
function updateClock(){
  const n=new Date();
  let h=n.getHours(),m=n.getMinutes(),s=n.getSeconds();
  const ap=h>=12?'PM':'AM';h=h%12||12;
  document.getElementById('clock').innerHTML=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}<span class="clock-ampm">${ap}</span>`;
  document.getElementById('clockSec').textContent=String(s).padStart(2,'0')+'s';
  document.getElementById('clockSub').textContent=n.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long'});
  const fc=document.getElementById('focusClock');
  if(fc) fc.textContent=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
}
updateClock();setInterval(updateClock,1000);

/* ‚ïê‚ïê‚ïê GREETING ‚ïê‚ïê‚ïê */
function setGreeting(){
  const name=cfg.greetName||'Prasann';
  const msgs=GREETINGS_POOL.map(g=>g.replace('Prasann',name));
  const msg=msgs[Math.floor(Math.random()*msgs.length)];
  const el=document.getElementById('greeting');
  el.innerHTML=`<em class="animated-text">${msg}</em>`;
  document.getElementById('dateText').textContent=new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'});
  document.getElementById('focusDate').textContent=new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});
  setTimeout(applyTextAnim,50);
}

/* ‚ïê‚ïê‚ïê QUOTES ‚ïê‚ïê‚ïê */
let quoteTimer;
function showQuote(){
  const el=document.getElementById('quoteStrip'),fq=document.getElementById('focusQuote');
  const q=MOTIVATIONS[Math.floor(Math.random()*MOTIVATIONS.length)];
  el.classList.remove('qfade');void el.offsetWidth;
  el.textContent=q;el.style.opacity='1';el.classList.add('qfade');
  if(fq) fq.textContent=q;
}
function restartQuotes(){clearInterval(quoteTimer);showQuote();quoteTimer=setInterval(showQuote,cfg.qInt*1000);}

/* ‚ïê‚ïê‚ïê SEARCH ‚ïê‚ïê‚ïê */
function doSearch(e){
  e.preventDefault();
  const q=document.getElementById('searchInput').value.trim();if(!q)return;
  const engine=document.getElementById('engineSelect').value;
  location.href=q.match(/^https?:\/\//)?q:engine+encodeURIComponent(q);
}

/* ‚ïê‚ïê‚ïê QUICK LINKS ‚ïê‚ïê‚ïê */
function renderLinks(){
  const c=document.getElementById('quickLinks');
  c.innerHTML=links.map((l,i)=>`
    <a class="ql-item" href="${l.url}" title="${l.label}">
      <span class="ql-icon">${l.icon}</span>
      <span class="ql-lbl-s">${l.label}</span>
      <button class="ql-del" onclick="rmLink(event,${i})">‚úï</button>
    </a>`).join('')+
    `<div class="ql-item ql-add" onclick="openModal('link')">
      <span class="ql-icon" style="opacity:.3">Ôºã</span>
      <span class="ql-lbl-s">Add</span>
    </div>`;
  c.querySelectorAll('.ql-item:not(.ql-add)').forEach(el=>{
    const d=el.querySelector('.ql-del');
    el.addEventListener('mouseenter',()=>d&&(d.style.display='flex'));
    el.addEventListener('mouseleave',()=>d&&(d.style.display='none'));
  });
}
function rmLink(e,i){e.preventDefault();e.stopPropagation();links.splice(i,1);ss('hp3_links',JSON.stringify(links));renderLinks();showToast('Removed.');}
function addLink(){
  const name=document.getElementById('newName').value.trim();
  const url=document.getElementById('newUrl').value.trim();
  const icon=document.getElementById('newIcon').value.trim()||'üîó';
  if(!name||!url)return;
  links.push({icon,label:name,url:url.startsWith('http')?url:'https://'+url});
  ss('hp3_links',JSON.stringify(links));renderLinks();closeModal('link');
  ['newName','newUrl','newIcon'].forEach(id=>document.getElementById(id).value='');
  showToast('Link added!');
}

/* ‚ïê‚ïê‚ïê TOP SITES ‚ïê‚ïê‚ïê */
function renderTopSites(){
  document.getElementById('topSites').innerHTML=topSites.slice(0,8).map((s,i)=>`
    <a class="ts-item" href="${s.url}">
      <span class="ts-icon">${s.icon}</span>
      <span class="ts-lbl">${s.label}</span>
    </a>`).join('');
}
function addSite(){
  const name=document.getElementById('siteName').value.trim();
  const url=document.getElementById('siteUrl').value.trim();
  const icon=document.getElementById('siteIcon').value.trim()||'üåê';
  if(!name||!url)return;
  topSites.push({icon,label:name,url:url.startsWith('http')?url:'https://'+url});
  ss('hp3_top',JSON.stringify(topSites));renderTopSites();closeModal('site');
  ['siteName','siteUrl','siteIcon'].forEach(id=>document.getElementById(id).value='');
  showToast('Site added!');
}

/* ‚ïê‚ïê‚ïê BOOKMARKS ‚ïê‚ïê‚ïê */
function renderBookmarks(){
  document.getElementById('bookmarks').innerHTML=bookmarks.map(b=>`<a class="bchip glass" href="${b.url}">${b.icon} ${b.label}</a>`).join('');
}

/* ‚ïê‚ïê‚ïê NOTES ‚ïê‚ïê‚ïê */
const NOTE_LABELS=['‚Ä¢ 1','‚Ä¢ 2','‚Ä¢ 3'];
const notesEl=document.getElementById('notes');
function renderNoteTabs(){
  document.getElementById('notesTabs').innerHTML=NOTE_LABELS.map((l,i)=>
    `<div class="note-tab${i===activeNote?' active':''}" onclick="switchNote(${i})">${l}</div>`).join('');
}
function switchNote(i){notePages[activeNote]=notesEl.value;activeNote=i;notesEl.value=notePages[i];renderNoteTabs();updateNotesCount();}
notesEl.value=notePages[activeNote];renderNoteTabs();

let saveTimer;
function updateNotesCount(){document.getElementById('notesCount').textContent=notesEl.value.length+' chars';}
notesEl.addEventListener('input',()=>{
  notePages[activeNote]=notesEl.value;updateNotesCount();
  clearTimeout(saveTimer);document.getElementById('notesSave').textContent='saving‚Ä¶';
  saveTimer=setTimeout(()=>{ss('hp3_notes',JSON.stringify(notePages));document.getElementById('notesSave').textContent='saved ‚úì';},600);
});
updateNotesCount();

/* ‚ïê‚ïê‚ïê HABITS ‚ïê‚ïê‚ïê */
function renderHabits(){
  document.getElementById('habitDate').textContent=todayStr();
  const c=document.getElementById('habitList');
  const done=Object.keys(habitDone).length;
  document.getElementById('habitStat').textContent=`${done}/${habits.length} habits`;
  if(!habits.length){c.innerHTML='<div style="font-size:0.7rem;color:rgba(255,255,255,0.5);padding:4px 0;">No habits yet!</div>';return;}
  c.innerHTML=habits.map((h,i)=>{
    const isDone=!!habitDone[h.id];
    return `<div class="habit-item">
      <div class="habit-chk${isDone?' done':''}" onclick="toggleHabit(${i})">${isDone?'‚úì':''}</div>
      <span class="habit-name${isDone?' done':''}">${h.icon} ${h.name}</span>
      <span class="habit-streak">üî•${h.streak}</span>
      <button class="habit-del" onclick="rmHabit(${i})">‚úï</button>
    </div>`;
  }).join('');
}
function toggleHabit(i){
  const h=habits[i];
  if(habitDone[h.id]){delete habitDone[h.id];if(h.streak>0)h.streak--;}
  else{habitDone[h.id]=true;h.streak=(h.streak||0)+1;}
  ss('hp3_hdone_'+todayStr(),JSON.stringify(habitDone));
  ss('hp3_habits',JSON.stringify(habits));renderHabits();
}
function rmHabit(i){habits.splice(i,1);ss('hp3_habits',JSON.stringify(habits));renderHabits();showToast('Habit removed.');}
function addHabit(){
  const v=document.getElementById('habitInput').value.trim();if(!v)return;
  habits.push({id:Date.now(),icon:'‚úÖ',name:v,streak:0});
  ss('hp3_habits',JSON.stringify(habits));renderHabits();
  document.getElementById('habitInput').value='';showToast('Habit added!');
}
function addHabitModal(){
  const name=document.getElementById('habitModalName').value.trim();if(!name)return;
  const icon=document.getElementById('habitModalIcon').value.trim()||'‚úÖ';
  habits.push({id:Date.now(),icon,name,streak:0});
  ss('hp3_habits',JSON.stringify(habits));renderHabits();closeModal('habit');
  ['habitModalName','habitModalIcon'].forEach(id=>document.getElementById(id).value='');
  showToast('Habit added!');
}
document.getElementById('habitInput').addEventListener('keydown',e=>{if(e.key==='Enter')addHabit();});
renderHabits();

/* ‚ïê‚ïê‚ïê WEATHER ‚ïê‚ïê‚ïê */
const WX_ICONS={0:'‚òÄÔ∏è',1:'üå§',2:'‚õÖ',3:'‚òÅÔ∏è',45:'üå´',48:'üå´',51:'üå¶',53:'üå¶',55:'üåß',61:'üåß',63:'üåß',65:'üåß',71:'‚ùÑÔ∏è',73:'‚ùÑÔ∏è',75:'‚ùÑÔ∏è',80:'üå¶',81:'üå¶',82:'üåß',95:'‚õà',96:'‚õà',99:'‚õà'};
const WX_DESC={0:'Clear sky',1:'Mainly clear',2:'Partly cloudy',3:'Overcast',45:'Foggy',51:'Light drizzle',53:'Drizzle',55:'Heavy drizzle',61:'Light rain',63:'Rain',65:'Heavy rain',71:'Light snow',73:'Snow',75:'Heavy snow',80:'Showers',82:'Heavy showers',95:'Thunderstorm',96:'Thunderstorm',99:'Thunderstorm'};
async function fetchWeather(){
  const city=document.getElementById('wxCityInput').value.trim();if(!city)return;
  cfg.wxCity=city;saveCfg();
  document.getElementById('wxCity').textContent='Loading‚Ä¶';
  try{
    const geo=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1`).then(r=>r.json());
    if(!geo.results?.length){document.getElementById('wxCity').textContent='City not found';return;}
    const{latitude,longitude,name}=geo.results[0];
    const wx=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=apparent_temperature&timezone=auto&forecast_days=1`).then(r=>r.json());
    const{temperature,weathercode,windspeed}=wx.current_weather;
    const hr=new Date().getHours();
    const feels=wx.hourly?.apparent_temperature?.[hr];
    document.getElementById('wxIcon').textContent=WX_ICONS[weathercode]||'üå°';
    document.getElementById('wxTemp').textContent=Math.round(temperature)+'¬∞C';
    document.getElementById('wxCity').textContent=name;
    document.getElementById('wxDesc').textContent=WX_DESC[weathercode]||'';
    document.getElementById('wxFeels').textContent=feels!=null?`Feels ${Math.round(feels)}¬∞C ¬∑ Wind ${windspeed}km/h`:`Wind ${windspeed}km/h`;
    document.getElementById('wxCard').onclick=null;
    showToast('Weather updated!');
  }catch(e){document.getElementById('wxCity').textContent='Error fetching';showToast('Weather error.');}
}
if(cfg.wxCity){document.getElementById('wxCityInput').value=cfg.wxCity;fetchWeather();}

/* ‚ïê‚ïê‚ïê POMODORO ‚ïê‚ïê‚ïê */
let pomoMode='focus',pomoRunning=false,pomoTimer=null;
let pomoSecsLeft=cfg.pomoF*60,pomoTotalSecs=cfg.pomoF*60;
let pomoSessions=parseInt(ls('hp3_pomo_sess')||'0');
const CIRC=2*Math.PI*32;

function pomoDur(m){return m==='focus'?cfg.pomoF:m==='short'?cfg.pomoS:cfg.pomoL;}
function setPomoMode(m){
  if(pomoRunning)return;
  pomoMode=m;
  ['Focus','Short','Long'].forEach(t=>document.getElementById('pomoTab'+t).classList.remove('active'));
  document.getElementById('pomoTab'+m.charAt(0).toUpperCase()+m.slice(1)).classList.add('active');
  pomoSecsLeft=pomoDur(m)*60;pomoTotalSecs=pomoSecsLeft;
  renderPomo();document.getElementById('pomoStatus').textContent='Paused';
}
function renderPomo(){
  const mi=Math.floor(pomoSecsLeft/60),se=pomoSecsLeft%60;
  document.getElementById('pomoTime').textContent=`${String(mi).padStart(2,'0')}:${String(se).padStart(2,'0')}`;
  const pct=pomoSecsLeft/pomoTotalSecs;
  document.getElementById('pomoArc').style.strokeDashoffset=CIRC*(1-pct);
  document.getElementById('pomoArc').style.stroke=pomoMode==='focus'?'var(--accent)':pomoMode==='short'?'var(--accent2)':'var(--accent3)';
  document.getElementById('pomoSessions').textContent=`Sessions: ${pomoSessions}`;
  document.getElementById('pomoStat').textContent=`${pomoSessions} sessions`;
}
function togglePomo(){
  if(pomoRunning){
    clearInterval(pomoTimer);pomoRunning=false;
    document.getElementById('pomoStartBtn').textContent='‚ñ∂ Start';
    document.getElementById('pomoStatus').textContent='Paused';
  }else{
    pomoRunning=true;
    document.getElementById('pomoStartBtn').textContent='‚è∏ Pause';
    document.getElementById('pomoStatus').textContent=pomoMode==='focus'?'Focusing‚Ä¶':'On break';
    pomoTimer=setInterval(()=>{
      pomoSecsLeft--;renderPomo();
      if(pomoSecsLeft<=0){
        clearInterval(pomoTimer);pomoRunning=false;
        document.getElementById('pomoStartBtn').textContent='‚ñ∂ Start';
        if(pomoMode==='focus'){pomoSessions++;ss('hp3_pomo_sess',pomoSessions);}
        showToast(pomoMode==='focus'?'Session done! üéâ':'Break over! Back to work.');
        try{const ctx=new(window.AudioContext||window.webkitAudioContext)();const o=ctx.createOscillator();const g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sine';o.frequency.setValueAtTime(880,ctx.currentTime);g.gain.setValueAtTime(0.28,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+1.2);o.start();o.stop(ctx.currentTime+1.2);}catch(e){}
        const next=pomoMode==='focus'?(pomoSessions%4===0?'long':'short'):'focus';
        setPomoMode(next);
      }
    },1000);
  }
}
function resetPomo(){clearInterval(pomoTimer);pomoRunning=false;document.getElementById('pomoStartBtn').textContent='‚ñ∂ Start';document.getElementById('pomoStatus').textContent='Paused';setPomoMode(pomoMode);}
function skipPomo(){clearInterval(pomoTimer);pomoRunning=false;document.getElementById('pomoStartBtn').textContent='‚ñ∂ Start';const n=pomoMode==='focus'?'short':'focus';setPomoMode(n);}
renderPomo();

/* ‚ïê‚ïê‚ïê COUNTDOWN ‚ïê‚ïê‚ïê */
let cdownInterval;
function renderCountdown(){
  if(!cfg.countdown)return;
  const{label,ts}=cfg.countdown;
  document.getElementById('cdownLabel').textContent='Until '+label;
  function tick(){
    const diff=ts-Date.now();
    if(diff<=0){clearInterval(cdownInterval);['cdownD','cdownH','cdownM','cdownS'].forEach(id=>document.getElementById(id).textContent='0');return;}
    const d=Math.floor(diff/86400000);
    const h=Math.floor((diff%86400000)/3600000);
    const m=Math.floor((diff%3600000)/60000);
    const s=Math.floor((diff%60000)/1000);
    const vals={d,h:String(h).padStart(2,'0'),m:String(m).padStart(2,'0'),s:String(s).padStart(2,'0')};
    ['d','h','m','s'].forEach(k=>{
      const el=document.getElementById('cdown'+k.toUpperCase());
      if(el.textContent!==String(vals[k])){
        el.textContent=vals[k];el.classList.remove('tick');void el.offsetWidth;el.classList.add('tick');
      }
    });
  }
  clearInterval(cdownInterval);tick();cdownInterval=setInterval(tick,1000);
}
function setCountdown(){
  const name=document.getElementById('cdownName').value.trim();
  const dateStr=document.getElementById('cdownDate').value.trim();
  if(!name||!dateStr)return;
  const ts=new Date(dateStr).getTime();
  if(isNaN(ts)){showToast('Invalid date');return;}
  cfg.countdown={label:name,ts};saveCfg();renderCountdown();closeModal('countdown');showToast('Countdown set!');
}
if(cfg.countdown) renderCountdown();

/* ‚ïê‚ïê‚ïê FOCUS MODE ‚ïê‚ïê‚ïê */
let focusOpen=false;
function toggleFocus(){
  focusOpen=!focusOpen;
  document.getElementById('focusMode').classList.toggle('open',focusOpen);
  if(focusOpen) showQuote();
}

/* ‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê */
function openModal(t){document.getElementById(t+'Modal').classList.add('open');}
function closeModal(t){document.getElementById(t+'Modal').classList.remove('open');}
document.querySelectorAll('.modal-overlay').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));

/* ‚ïê‚ïê‚ïê KEYBOARD ‚ïê‚ïê‚ïê */
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){document.querySelectorAll('.modal-overlay').forEach(m=>m.classList.remove('open'));closeSettings();if(focusOpen)toggleFocus();}
  if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();document.getElementById('searchInput').focus();}
  if((e.metaKey||e.ctrlKey)&&e.key===','){e.preventDefault();openSettings();}
  if((e.metaKey||e.ctrlKey)&&e.shiftKey&&e.key==='F'){e.preventDefault();toggleFocus();}
});
document.getElementById('searchInput').focus();

/* ‚ïê‚ïê‚ïê PARTICLES ‚ïê‚ïê‚ïê */
function initParticles(count){
  const c=document.getElementById('particles');if(!c)return;c.innerHTML='';
  count=Math.max(0,Math.min(200,Math.floor(count)));
  for(let i=0;i<count;i++){
    const p=document.createElement('div');p.className='pt';
    const sz=Math.random()*3+1;
    p.style.cssText=`width:${sz}px;height:${sz}px;left:${Math.random()*100}%;animation-duration:${10+Math.random()*16}s;animation-delay:${Math.random()*22}s;`;
    c.appendChild(p);
  }
}

/* ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê */
renderLinks();
renderTopSites();
renderBookmarks();
applyAll();
setGreeting();
restartQuotes();
</script>
</body>
</html>
